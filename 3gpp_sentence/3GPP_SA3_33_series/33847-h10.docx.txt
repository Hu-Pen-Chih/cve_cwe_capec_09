The present document studies the security and privacy aspects of proximity based services (including public safety and commercial proximity services) in the 5G system.
It ensures that the security solutions are aligned with the work in TR 23.752 ,and.
The UE can discover other UE(s) with interested application(s) and/or interested group(s) using the ProSe direct discovery procedure.
The Restricted ProSe direct discovery procedure is used for a UE to discover or be discovered by other UE(s) in proximity over the PC5 interface.
Meanwhile, AKMA has been defined in , and GBA is under study to adapt to the 5G system.
Which network function derives the discovery key.- Provisioning of keys to support discovery when the UE is out of coverage.
Both options described above require a PC5 unicast link between the remote UE and UE-to-Network relay.
Therefore, it - How to transfer data between the Remote UE and the network over the UE-to-Network Relay.
The UE-to-Network Relay in 5G is enhanced compared to LTE ProSe, to support commercial use cases.
This Public safety enabled UEs can be considered under control by e.g., police or government.
The UE-to-UE Relay being an untrusted node Therefore, end-to-end security between the peer UEs communicating over the UE-to-UE Relay is needed.
This key issue covers both Layer-2 and Layer-3 relays in 5G Proximity Services.
detailsThe LTE ProSe one-to-one communication The detailed one-to-one (i.e. unicast) communication and the corresponding security aspects are defined for LTE ProSe inand, respectively.
This conversion/mapping procedure Unless the conversion is carefully performed, the group membership of specific UEs could be disclosed.
In 5GS, ProSe services can be used for both public safety services and commercial services (e.g. interactive service).
In TR 23.752 , group communications for commercial services have been studied.
Therefore, the security of ProSe group communications for commercial services needs to be considered.
Whether "non-IP type" is used for "Unstructured type" can be decided in normative phase.
Whether "non-IP type" is used for "Unstructured type" can be decided in the normative phase.
PCF provisions the authorization policy and parameters for 5G UE-to-Network Relay Discovery and Communication and the related discovery security materials are provisioned by 5GDDNMF.
This solution is based on single hop relay i.e., one UE-to-Network relay between Remote UE and the core network.
Step 25-26: The REAR key is generated at the AUSF same as in step 5.
The remote UE and relay AMF acquire the REAR key from the key response message received from AUSF.
The AUSF has a new role in this solution as a Key Management Function along with the functionality of an authentication server.
No new NF is introduced for the key management and the already available key from primary authentication is used.
For 5G ProSe, the security can be established using Authentication and Key Management for Applications.
Note 2: Whether AKMA user plane architecture is used out of scope of the present document.
In 5G ProSe, the 5G Direct Discovery Name Management Function (DDNMF) is used to replace the ProSe function in the open discovery.
(e.g. Solution #27).Note 3: The detailed security-related parameters in the announcing message are not addressed in the present document.
The DDNMF stores the Discovery Key with the ProSe App Code.
The announcing UE obtains a value for a UTC-based counter associated with a discovery slot based on UTC time.
The counter is set to a value of UTC time in granularity of seconds.
The four least significant bits of UTC-based counter are transmitted along with the discovery message.
The UE sets its ProSe clock to CURRENT_TIME and stores the MAX_OFFSET parameter, overwriting any previous values.
The monitoring UE obtains a value for a UTC-based counter associated with a discovery slot based on UTC time.
The counter is set to a value of UTC time in granularity of seconds.
The DDNMF in the HPLMN of the monitoring UE acknowledges the check result to the monitoring UE.
The DDNMF returns the parameter ProSe Application ID to the UE.
It proposes to reuse the restricted discovery security mechanisms of Model A and Model B specified infor 5G ProSe restricted discovery.
(e.g. Solution #28)Note 3: The detailed security-related parameters in the announcing message are not addressed in the present document.
The Code-Receiving Security Parameters provide the information needed by the Monitoring UE to undo the protection applied by the announcing UE.
The DUIK be included as a separate parameter if the Code-Receiving Security Parameters indicate that the Monitoring UE uses Match Reports for MIC checking.
The DDNMF in the HPLMN of the Monitoring UE returns the Discovery Filter and the Code-Receiving Security Parameters, along with the CURRENT_TIME and MAX_OFFSET parameters.
The four least significant bits of the UTC-based counter are transmitted along with the protected discovery message.
The DDNMFs in the HPLMN and VPLMN of the Discoveree UE exchange Announce Auth. messages.
If the Discoveree UE is not roaming, these steps do not take place.
The DDNMF in the HPLMN of the Discoverer UE sends an authorization request to the ProSe Application Server.
The four least significant bits of UTC-based counter are transmitted along with the protected discovery message.
The Discoverer UE listens for a discovery message that satisfies its Discovery Filter.
In order to find such a matching message, it processes the message.
If the Discoverer UE was not asked to send Match Reports for MIC checking, it stops at this step from a security perspective.
It also provides the CURRENT_TIME parameter, by which the UE (re)sets its ProSe clock.
The DDNMF in the HPLMN of the Discoverer UE includes the Match Report refresh timer in the message to the Discoverer UE.
The Match Report refresh timer indicates how long the UE will wait before sending a new Match Report for the ProSe Response Code.
This solution supports integrity protection, confidentiality protection, and replay protection of the discovery message.
This solution can ensure source authentication of the discovery messages when match reports are used.
signalling flow in clause 6.5.2-1 describes the establishment of TLS 1.3 with PSK authentication.
The UE sends Client Hello where the ClientHello contains a pre_shared_key extension containing a PSK identity formatted from A-KID and g. psk_dhe_ke.
The AAnF looks up the KAKMA key using the A-KID and generates a KAF key from the KAKMA key.
The AF server responds with a Server Hello with a pre_shared_key extension indicating the chosen PSK identity.
Note: It is not addressed in the present document how this solution supports roaming.
The Remote UE gets authenticated and authorized by the network to act as a Remote UE.
The Remote UE mutually authenticates with and registers in the 5GC.
The network provides the 5G PKMF address and the Relay Service Code to the Remote UE.
Step 6) The UE-to-network relay gets authenticated and authorized by the network to act as a UE-to-network relay.
Step 8) UE-to-network relay discovery is taken place on the PC5 interface using either model A or model B discovery.
Step 10) The UE-to-network relay establishes a secure connection with the 5G PKMF.
As this connection is established in the user plane, the same mechanism as used to protect the PC3 interface can be re-used.
Either solution #5 or solution #11 can be used for securing the connection.
The 5G PKMF needs to check that the Nonce-1 is not replayed.
The UE-to-network Relay generates the KSESS key for PC5 communication from the KPC5-COM key received from the 5G PKMF and the Nonce_2.
The UE-to-network Relay initiates a Direct Security Mode Command integrity protected with the KSESS-IK key generated from the KSESS key.
The UE-to-network Relay calculates a MAC over the parameters included in the Direct Security Mode Complete message.
The Remote UE processes the Direct Security Mode Command by verifying the MAC using a KSESS-IK key generated from the KSESS key.
This solution assumes and requiresThe key for PC5 communication is retrieved from the 5G PKMF in the Remote UE's HPLMN.
In Solution #6, the Remote UE and UE-to-network relay belongs to the same HPLMN.
In Solution #21, the Remote UE and UE-to-network relay belongs to different HPLMN's.
This solution addresses Key Issue #12: Security of one-to-one communication over PC5.
The one-to-one communication establishment starts with a Direct Communication Request (DCR) message to send the initiating UE's security capabilities and to trigger the mutual authentication.
Finally, the receiving UE replies a Direct Communication Accept (DCA) message to confirm the user plane protection methods and finish the one-to-one communication establishment procedures.
After step 0, the following steps 1-6 are done either within coverage or out-of-coverage.2.
The initiating UE starts Direct Communication Request (DCR) message contains and the initiating UE's security capabilities.
The initiating UE's security capabilities are sent back to the initiating UE to mitigate the bidding down attack.
The receiving UE integrity protects the Direct Security Mode Command message before sending it to the initiating UE.6.
The receiving replies the Direct Communication Accept message to accept the DCR message and one-to-one communication establishment including the user plane security indication.
The privacy protection of entities is not addressed in this solution.
An "extended" unicast link is established between source UE and target UE, via the UE-to-UE Relay.
Note 2: It is not addressed in the present document whether and (if yes, then)how to protect the privacy of the routing information.
Note 4: Public/private keys provisioning into the peer UEs is not addressed in the present documentNot addressed in the present document.
This solution addresses the key issue #2: Keys in ProSe discovery scenario.
This solution proposes to generate a discovery root key from AUSF and the 5G DDNMF derives the discovery keys.
At the UE side, UE generates both discovery root key and discovery keys.
NOTE 1: The detail of SBI used between 5G DDNMF and AMF is not introduced in this solution.
In user plane architecture as illustrated in clause 4.1.2, a UE reaches the 5G DDNMF via user plane.
The 5G DDNMF allocates the Prose APP code and gets the discovery root key from AAnF.
The AAnF will generate the discovery root key based on the KAKMA as described in .
The 5G DDNMF will send the key material to the UE via the PC3a protocol.
The Remote UE learns about the connectivity service as part of the discovery procedure.
It is assumed that the relay's Allowed NSSAI includes the S-NSSAIs needed to provide the connectivity service.
Solution detailsNOTE 1: Krelay and Krelay ID are reused during reconnection in the same way as KNRP and KNRP ID in .
The Relay UE's AMF checks that the Relay UE is authorized to act as a Relay based on subscription information obtained during Relay UE's registration9.
Upon successful authentication of the network, the Remote UE derives a PC5 link root key Krelay and its Krelay ID from KAMF10.
Upon successful authentication of the Remote UE, Relay UE's AMF checks with Remote UE's UDM that Remote UE is authorized to use UE-to-Network relaying.
Upon successful authorization check, Relay UE's AMF registers with Remote UE's UDM as its Relay's AMF, providing the Relay UE identity (SUPI or GPSI).12.
Relay UE's AMF sends a NAS Relay Authorization response message to the Relay UE.
The Relay UE's AMF includes the PC5 link root key Krelay and its Krelay ID in the message.
The Remote UE checks that the received Krelay ID matches the one derived in step 9.
The Remote UE performs security checks of the Direct Security Mode Command message as in .16.
The Remote UE has registered with the network and established a 5G native security context with a source AMF.
The Relay UE is registered and authorized to operate as a relay.4.
The target AMF checks that Relay UE is authorized to act as a relay.6.
[option 1] The source AMF locates the Remote UE's security context using the received Remote UE's 5G-GUTI.
The source AMF checks the integrity protection of the message from the Remote UE using the Remote UE's security context.
If the security checks are successful, the source AMF derives a Krelay and Krelay ID from KAMF identified by the ngKSI.
[option 2] Alternatively, the source AMF The derivation of the new KAMF is specified in(Annex A.13).
The source AMF sends a response message to the target AMF that includes the Remote UE SUPI.
If not provided by the source AMF, the target AMF derives a Krelay and Krelay ID using Remote UE's security context.9.
When there is a KAMF change (option 2), how to deal with desynchronization of K_AMF is not addressed in the present document.
The Relay UE verifies the Direct Security Mode Complete message security using security derived from Krelay.
A successful security verification indicates to the Relay UE that the Remote UE is authorized to use the relay service provided by Relay UE.
In that case, 5G-GUTI re-allocation by source AMF over Uu is performed as per, clause 6.12.3.
An attacker cannot track the Remote UE using the 5G-GUTI during communication with the Relay UE.
In that case, it is left to implementation (i.e., not required) to re-assign a 5G-GUTI.
Krelay-sess is derived from Krelay using nonces exchanged during the PC5 link establishment similarly to how KNRP-sess is derived from KNRP in Annex A.3 of.
distinguisherThe access type distinguisher is set to the value for non-9 in).
The solution fulfils requirements of KI#3 (secure means to establish a PC5 link) using keys from the primary authentication to derive PC5 related keys.
Another impact on 5GC and the existing procedure is documented in TR 23.752sol#47, clause 6.47.3.
Then, the UE and the Application Function can exchange application data over the secure tunnel.
Likewise, UE1 In that case, all Target UEs needs to be informed of UE1's new IP address/prefix.
This solution applies to Layer-3 based Solution #10 and Solution #32 described in TR 23.752 .
Since Solution #10 and Solution #32 described in TR 23.752are similar, this proposed solution applies to both of them.
The main difference between Solution #10 and Solution #32 described in TR 23.752is the proposed method of IP address/prefix allocation.
In Solution #10, the UE-to-UE Relay allocates the IP address/prefix to the UE.
In Solution #32, a link-local IP address that is assigned by the UE itself is used and sent to the UE-to-UE Relay.
Figure 6.12.2-1: Privacy handling for Layer-3 based UE-to-UE Relay4) UE2 saves UE1's new IP address/prefix.
At this point, UE2 still sends/receives IP data using UE1's old IP address/prefix until an IP packet using UE1's new IP address/prefix is received.
At that point, UE2 starts using UE1's new IP address/prefix and forgets UE1's old IP address/prefix.
This solution especially describes how to perform the secondary authentication for Remote UE.
The ProSe 5G UE-to-Network Relay S-NSSAI, DNN, SSC mode, or PDU Session Type.
As part of the discovery procedure, the Remote UE learns about the connectivity service the ProSe UE-to-Network Relay provides.
NOTE 1: The secondary authentication of the UE-to-Network Relay UE takes part in the general PDU session establishment.4.
For IP PDU Session Type and IP traffic over the PC5 reference point, the IPv6 prefix or IPv4 address is allocated for the remote UE.
The SMF receives the Remote UE's SUPI from the AMF, obtained during step 3.
The solution assumes that the used EAP method provides the necessary security (e.g., for user id privacy protection).1.
The ProSe 5G UE-to-Network Relay S-NSSAI, DNN, SSC mode, or PDU Session Type.
As part of the discoveryNOTE 1: The secondary authentication of the UE-to-Network Relay UE takes part in the general PDU session establishment.4.
The SMF receives the Remote UE's SUPI from the AMF, obtained during step 3. 5.
The 5G ProSe UE-to-Network Relay sends an EAP message to the Remote UE via PC5 signalling.
The Remote UE sends an EAP message to the 5G ProSe UE-to-Network Relay via PC5 signalling.7.
The SMF sends PDU Session Establishment Accept or PDU Session Modification Command to accept Remote UE's request.13.
The SMF sends PDU Session Establishment Reject or PDU Session Modification Command to the 5G ProSe UE-to-Network Relay UE to reject Remote UE's request.
This solution addresses Key Issue #3 on Security of UE-to-Network Relay.
The solution is based on TR 23.752 solution #7 which is a Layer 2 Relay solution.
If in coverage, the Remote UE and UE-to-Network Relay UE independently get the service authorization for indirect communication from the network.
The relay UE transitions to the connected state by sending a service request.
The data is transmitted between Remote UE and UPF via UE-to-Network Relay UE and NG-RAN.
The UE-to-Network Relay UE forwards all the data messages between the Remote UE and NG-RAN using RAN specified L2 relay method.
How AS security between the Remote UE and the NG-RAN is established is not detailed in the solution.
This solution provides a mechanism to set up PC5 link security between a remote UE and UE-to-network relay based on primary authentication.
The procedure for key management in UE-to-Network relay using primary authentication is depicted in Figure 6.15.2-1.
Figure 6.15.2-1: Procedures for key management in ProSe UE-to-Network Relay based on primary authentication1.
The Remote UE sends a NAS relay Key request message with relay service code for PC5 communication with a UE-to-network relay.3.
The Remote AUSF that serves the remote UE generates P-KID for the relay service code in the Nausf_ProSe_RelayKey request.
The username part includes the Routing Identifier and the P-TID (ProSe Temporary UE Identifier), and the realm part includes Home Network Identifier.5.
The Direct Communication Request contains the Relay Service Code, P-KID, and Nonce1.
The UE-to-Network relay triggers the PC5 root key (i.e. PC5 root key for communicating with the remote UE) retrieval procedure.
The Relay sends NAS remote Key request with P-KID, Relay service code, Nonce 1.12.
UDM response to relay AMF via Nudm_AUSFID_Get with AUSF instance ID of the AUSF serving remote UE.15.
The remote AUSF sends Nausf_ProSe_RemoteKey response with KR, KR freshness parameter to the relay AMF.NOTE 2: This solution requires integrity and confidentiality protected NAS messages.
The remote UE triggers the 5GC network to derive the P-KID per service relay code and the remote UE derives the PKID locally.
During the shared key obtaining procedure, the 5GC check whether the relay UE is authorized to be a relay UE.
this solution, the PC5 link root key KR is sent over the air interface to the Relay UE.
It requires that the NAS message carrying KR is both integrity and confidentiality protected.
Otherwise, there is the risk that the root key KR is exposed in clear text if confidentiality protection of the NAS signalling is not activated.
Step 4: (Optional) UE-to-UE relay1 Then the UE2 stores the UE-to-UE relay1 ID.
NOTE 3: Details on Steps 1-4 can be found in the other solutions of the present document.
Step 8: UE1 and UE2 perform the indirect security mode command procedure to establish a secure connection, including the protection key and security algorithms.
Solution #17: Solution on securely creating destination Layer-2 ID in groupcast communicationThe detailed solution is illustrated in Figure 6.17.2-1.
Figure 6.17.2-1: Procedure for secure conversion of application layer group ID to destination Layer-2 ID1.
ID Update: When the timer T expires, a new destination Layer-2 ID is calculated using the next random number according to the sequence.
The group management server can also send the corresponding materials to generate random numbers rather than sending the random numbers themselves.
This solution provides a mechanism to set up a PC5 link between a remote UE and UE-to-network relay.
In addition, this solution describes how a Remote UE and UE-to-network relay get authorized by the ProSe Key Management Function and verify each other's roles.
This solution assumes the 5G Prose function and Prose Key Management Function as in LTE Prose.
This solution only describes the PC5 link setup procedure that is common for both L2 and L3 UE-to-network relay.0a.
The Remote UE gets the discovery parameters and ProSe Key management function (PKMF) address from the 5G DDNMF.0b.
For Public Safety use cases, the PKMF can be managed by the Public Safety service provider.2.
The discovery procedure is performed between the Remote UE and the UE-to-network Relay using the discovery parameters and discovery security material.3.
The UE-to-network relay sends a Key Request message that contains PRUK ID, RSC and KNRP freshness parameter 1 to the PKMF.
On receiving the Key Request message, the PKMF checks that the UE-to-network relay is authorized to act as a relay to the Remote UE.
Then, the PKMF sends a Key Response message that contains KNRP and KNRP freshness parameter 2 to the UE-to-network relay.
NOTE 5: The details on the security negotiation other than key derivation and its use would be based on the solutions for KI #12.5d.
On receiving and processing the Direct Security Mode Complete message, the UE-to-network relay checks the integrity of the Direct Security Mode Complete message.
If the integrity check is successful, the UE-to-network relay is assured that the Remote UE is authorized to get the relay service.
The Remote UE establishes a secure PC5 link with the UE-to-network (U2N) relay.3.
The protocol stacks for remote UE's control-plane and user-plane via N3IWF are shown in Figure 6.19.2.2-1 and 6.19.2.2-2 respectively.
This solution supports the confidentiality, integrity, and replay protection of the traffic between the remote UE and theThis solution addresses KI #6.
This solution provides a mechanism to set up a connection between remote UEs via the UE-to-UE relay.
This solution only describes the PC5 link setup procedure between the remote UE and the UE-to-UE relay and end-to-end security setup between remote UEs.
Note 2: The detail of discovery security materials is not addressed in the present document.0.
Furthermore, the Remote UEs can be provisioned with the security materials for end-to-end security setup by the PKMF.
For example, the security materials for end-to-end security setup include the Prose Service Code (PSC) and an associated key.
Remote UE 1 performs the discovery procedure and PC5 unicast link setup procedure with the UE-to-UE relay.
The Remote UE derives KNRP-SESS using KNRP, Nonce1, and Nonce2 and checks the integrity of the Direct Security Mode Command.
If the verification is successful, the Remote UE sends a Direct Security Mode Complete to the U2U relay.
For Public Safety use cases, the PKMF can be managed by the Public Safety service provider.3.
Remote UE 1 and Remote UE 2 can establish an end-to-end IPsec connection via U2U relay.
The Remote UE and the UE-to-network Relay have no knowledge of each other beforehand.
In this solution, the Remote UE has a 5G PKMF (5G PKMF-1) in its home PLMN for ProSe key management.
The UE-to-network relay has a 5G PKMF (5G PKMF-2) in its home PLMN for ProSe key management.
These two 5G PKMF's (5G PKMF-1 and 5G PKMF-2) can communicate with each other.
In Option 1, the UE-to network relay contacts the Remote UE's 5G PKMF-1 via its 5G PKMF-2.
The UE-to-network relay discovery is taken place on the PC5 interface using either model A or model B discovery.
But these other Remote UEs - In Option 1, the UE-to network relay contacts the Remote UE's 5G PKMF-1 via its 5G PKMF-2.
The UDM(Remote UE) provides the subscription information to the 5GDDNMF(Remote UE) in Nudm_SDM_Get_Response.
The 5GDDNMF(Remote UE) responds to the 5G PKMF-1(Remote UE) whether the authorization is successful or not.
The 5G PKMF-2(UE-to-network Relay) forwards the Key Response message to the UE-to-network Relay.
Step 7a) UE-to-network Relay establishes a secure connection with the 5GDDNMF of the Relay UE.
As this connection is established in the user plane, the same mechanism as used to protect the PC3 interface can be re-used.
Either solution #5 or solution #11 can be used for securing the connection.
The UE-to-network Relay contacts the 5GDDNMF of the UE-to-network relay and includes the HPLMN ID of the Remote UE and the Relay Service Code.
In this case, the 5G PKMF-1 does not contact the 5GDDNMF-1 as described in step 9a.
The 5G PKMF-1 generates a new key KPC5-COM key from at least the KPC5 key, Nonce_1, Relay Service Code and the new KPC5-COM freshness parameter.
The generation of the KPC5-COM key can be done in a similar way as described in Annex A.7 inif PRUK is replaced by KPC5 key.
The Remote UE then generates the KSESS key from the KPC5-COM key and Nonce_2.
In Option 1, the UE-to network relay contacts the Remote UE's 5G PKMF-1 via its 5G PKMF-2.
The same approach could be used for the 5G PKMF's in different PLMN's as described in Option 1.
This solution aligns with the key management for the discovery keys for the UE-to-network relay which is also performed over the user plane.
This solution has no impact on network nodes as RAN, AMF, and AUSF.
This solution has an impact on network nodes; potentially 5GDDNMF and potentially UDM.
In Solution #21, the Remote UE and UE-to-network relay belongs to different HPLMN's.
In Solution #6, the Remote UE and UE-to-network relay belongs to the same HPLMN.
Using a representation enables resistance to tracing and impersonation of UEs.
The codes/filters are generated by 5GC and used as theHence, the privacy of the ProSe application in discovery is protected.
This solution addresses Key Issue #12 Security of one-to-one communication over PC5.
This solution assumes that the security context is established based on keys derived from matching initial keys provided by the 5GC.
NOTE 2: Derivation of keys from the initial key can take place even when the ProSe UEs are outside the coverage area.3.
Upon expiration of the initial key, all keys derived from it will become invalid.
In order to continue secure communication, ProSe UEs need to request a new initial key from the 5GC.
Until they obtain the new initial key, ProSe UEs cannot perform direct communication with peer ProSe UEs.
NOTE 1: Steps 1-4 refer to actions performed between Announcing UE or Discoveree UE (referred to as UE-1) and the 5GC.2.
If UE-1 is authorized to perform ProSe direct communication, 5GDDNMF sends a key request to the 5G ProSe key management function.4.
This message also contains the address of the ProSe key management function.
It would enable UE-1 to contact the ProSe key management function directly at later stages.5.
This message also contains the address of ProSe key management function.
It would enable UE-2 to contact the ProSe key management function directly at later stages.10.
Upon completion of the validity period, AD-key along with keys derived from it will expire.13.
Upon completion of the validity period, MD-key along with keys derived from it will expire.
Address of the ProSe key management function obtained in step 4 is used by UE-2 to perform a key request.
A new key (MD-key-new) with an associated validity is issued to UE-1 along with its identifier.
The S-NSSAI subject to NSSAA is associated with the connectivity service (RSC) requested by the Remote UE.
The authentication messages for NSSAA of Remote UE are exchanged securely during or after the PC5 link establishment.
Upon successful completion of the NSSAA procedure by the Remote UE, the relay provides Remote UE access to the slice.
This solution assumes that the AMF serving the relay is always able to serve the Remote UE (same as solution #10, clause 6.10.1).
Figure 6.24.2.1-1: Procedure for PC5 link establishment with L3 UE-to-Network relay to use an S-NSSAI subject to NSSAA 0.
Remote UE is provisioned with authorization parameters to act as Remote UE.
Relay UE is provisioned with authorization parameters to act as a Relay UE.
Upon successful check, the AMF decides to trigger a primary authentication of Remote UE via the relay.7.
Figure 6.24.2.2-1: Procedure for NSSAA of Remote UE connecting via L3 UE-to-Network relay 1.
The relay UE or the AMF If the procedure is triggered by AMF steps 2 and 3 are skipped.
If the procedure is triggered by Relay step 8 is skipped.
The Relay sends a NAS request message to the AMF that includes the Remote UE id (e.g., SUPI, GPSI) and S-NSSAI.
Upon successful check, the AMF decides to trigger a primary authentication of Remote UE via the relay.6.
Figure 6.24.2.3-1: Procedure for AAA-S triggered Authorization Revocation to use S-NSSAI for Remote UE 0.
Remote UE is connected to the Relay UE and authorized to use an S-NSSAI subject to NSSAA.2.
NSSAAF requests UDM to get the ID of the AMF serving the Remote UE.
NSSAAF receives AMF ID and Relay UE GPSI (UDM has obtained info about Relay UE and its AMF prior, see clause 6.24.2.1, step 7).4.
AMF locates the Relay UE context and removes the association of Remote UE with S-NSSAI in the Relay UE context.
If no other S-NSSAI is used for Remote UE via the Relay UE, the AMF removes the Remote UE information from the Relay UE context.
AMF de-registers from the Remote UE's UDM if Remote UE info is removed from the Relay UE context.6.
The Relay UE discards S-NSSAI authorization information associated with Remote UE including Krelay/Krelay ID.8.
Remote UE is connected to the Relay UE and authorized to use an S-NSSAI subject to NSSAA.3.
AMF initiates a UCU procedure with the Relay to revoke the authorization for the relay to use the S-NSSAI.7.
For each Remote UE connected to the relay and associated with the revoked S-NSSAI, the relay initiates a link release procedure.
The contribution proposes a solution to address KI #4: Authorization in the UE-to-Network relay scenario.
The solution describes how to support a secondary authentication of a Remote UE via an L3 UE-to-Network relay.
Remote UE's primary authentication and access to subscription data are enabled via the network-controlled authorization procedure.
The procedure for PC5 link establishment with L3 UE-to-Network relay to use a PDU Session subject to secondary A&A is depicted in Figure 6.25.2.1-1.
Figure 6.25.2.1-1: Procedure for PC5 link establishment with L3 UE-to-Network relay to use a PDU Session subject to secondary A&A 0.
Remote UE is provisioned with authorization parameters to act as Remote UE.
Relay UE is provisioned with authorization parameters to act as a Relay UE.2.
The Remote UE and Relay UE perform a discovery procedure whereby the Remote UE 4.
The message If the PDU Session with secondary A&A fails, the relay sends a PC5 reject message indicating the failure cause.
The Relay sends a NAS message (e.g., PDU Session Modification or Establishment request or Remote UE Report) to the SMF.
Figure 6.25.2.3-1: procedure for DN-AAA triggered PDU Session Authorization Revocation for Remote UE 0.
The Remote UE is connected to the Relay UE and authorized to use PDU Session subject to secondary A&A.3.
The SMF sends a NAS command message to release the connection with the Remote UE whose authorization has been revoked.
The message includes the Remote UE identity (e.g., Remote User Id, GPSI), Remote UE addressing info, and an indication of the reason for the release.5.
: Procedure for DN-AAA triggered PDU Session Re-Authentication/Authorization for Remote UE 0.
The Remote UE is connected to the Relay UE and authorized to use a PDU Session subject to secondary A&A.4.
If new authorization information is provided by DN-AAA the SMF updates the Remote UE info in the Relay UE SM context accordingly.6.
The relay sends a PC5 message (e.g., a PC5 Link Modification Request) that includes an EAP success message.
In case of a failed re-A&A procedure, the relay initiates a PC5 link release procedure with Remote UE.
Two UEs the discovery request procedures are prerequisite steps of direct one-to-one communication).
Security flexibility is provided by introducing on-demand PC5 one-to-one communication policies.
The security policies for ProSe UEs PC5 security policies are provisioned according to different services and geographical area(s) based on the referenced technology inand.
The A-DDNMF returns the ProSe App Code, Discovery Key and other discovery parameters in the Discovery Response message.
The DDNMF returns the Discovery Filter containing the ProSe App Code(s) and/or the ProSe App Mask(s) with other discovery parameters in the Discovery Response message.
The M-DDNMF and A-DDNMF exchange Monitor Req/Resp messages if the ProSe Application ID indicates a different PLMN.
The one-to-one communication security policies are used to establish security during one-to-one communication establishment.
The M-DDNMF acknowledges the Monitoring UE to continue the subsequent procedures if passing the checks in step 6.
Otherwise, the M-DDNMF indicates the Monitoring UE to stop the procedure.
The Monitoring/Discoverer UE sends a Match Report to M-DDNMF including the MIC and ProSe Code if required.
Security flexibility is provided by introducing on-demand PC5 one-to-one communication policies and the policy mismatch during one-to-one communication establishment makes the discovery signalling pointless.
The solution requires that the 5G DDNMF has the logic to understand and check the match of PC5 security policies.
Two UEs the discovery request procedures are prerequisite steps of direct one-to-one communication).
Security flexibility is provided by introducing on-demand PC5 one-to-one communication policies.
The security policies for ProSe UEs PC5 security policies are provisioned according to different services and geographical area(s) based on the referenced technology inand.
The DDNMF The A-DDNMF further exchanges the announced authorization with the DDNMF of VPLMN if the Announcing/Discoveree UE is roaming.
The A-DDNMF rejects the monitor request if the security policies between the Announcing/Discoveree UE are in conflict with the security policies of the Monitoring/Discoverer UE.
The M-DDNMF returns the discovery parameters and the associated security materials to the Monitoring/Discoverer UE.
If the A-DDNMF rejects the Monitor Request, the M-DDNMF aborts the discovery procedure and inform the Monitoring/Discoverer UE.NOTE: This solution requires network coverage to work.
The solution The solution The solution requires that the 5G DDNMF has the logic to understand and check the match of PC5 security policies.
This solution addresses Key Issue #3, Key Issue #4, and Key Issue #9.
The solution reuses the PC5 unicast communication security procedure defined infor the PC5 communication security.
The Remote UE sends a Relay Key Request to the 5GPKMF of relay service.
The message includes Relay Service Code, and an optional 5GPRUK ID if the Remote UE already has a 5GPRUK.3.
The 5GPKMF of the relay service checks whether the Remote UE is authorized to be a Remote UE according to the Relay Service Code.5.
The Remote UE discovers the UE-to-network Relay using either model A or model B discovery.7.
The Relay UE sends a Relay Key Request to the 5GPKMF of relay service.
The message includes 5GPRUK ID or a SUCI of the Remote UE, Relay Service Code and Nonce_1.
The 5GPKMF of the relay service checks whether the Relay UE is authorized as a Relay UE according to the Relay Service Code.
The 5GPKMF of the relay service derives a 5GPRUK based on the AV and some other parameters, generates a corresponding 5GPRUK ID.
The 5GPKMF of the relay service also needs to generate a 5GPRUK_Info from which the Remote UE can derive 5GPRUK and obtain 5GPRUK ID.13.
The Relay UE sends a Direct Security Mode Command to the Remote UE.
In addition to the one-to-one communication parameters, the message includes the 5GKd Freshness Parameter and 5GPRUK_Info if it exists.17.
The Remote UE sends Direct Security Mode Complete message to Relay UE.
Figure 6.29.2-1: UE-to-network relay security flowThis solution introduces a method to establish a secure connection between the Remote UE and the UE-to-Network Relay UE.
The Relay UE sends a NAS Relay Key Request to its serving AMF.
The message includes the parameters received from the Remote UE, i.e. 5GPRUK ID and/or SUCI/GUTI, Relay Service Code and Nonce_1.
The Remote UE sends Direct Security Mode Complete message to Relay UE.
In this solution, the PC5 link root key 5GKD is sent over the air interface to the Relay UE.
It requires that the NAS message carrying 5GKD is both integrity and confidentiality protected.
Otherwise, there is the risk that the root key 5GKD is exposed in clear text if confidentiality protection of the NAS signalling is not activated.
This solution addresses key issue #7 (Authorization in the UE-to-UE relay scenario).
The 5GS also supports authorization of the UE requesting to act as a UE-to-UE relay.
The authorization token has an expiration time and is signed with the private key of the CN.
The CN also provides the public key to the source UE and the UE-to-UE relay used for verifying the token from other parties.
Step 3: Authentication and key agreement Step 5: The source UE sends Direct Security Mode Complete message to the UE-to-UE relay.
The source UE could also include the authorization token-1 in separate signalling procedures as shown in step 7/7a to the UE-to-UE relay.
When the UE-to-UE relay receives the authorization token-1 from the source UE, it can verify the authorization token-1.
Alignment with SA2 on these aspects can be done during the SA3 normative phase.
Otherwise, the AMF breaks off the procedure if these do not match.
Step 10: The UE-to-Network relay can now start relaying data from the Remote UE to the network via the selected UE-to-Network relay.
Hence, the security requirements of key issue #16 are met during discovery.
Hence, if ALTERNATIVE 2 is adopted given its stronger privacy guarantees, then alignment with SA2 will be required.
The initiating UE and receiving UE already have established ProSe one-to-one communication.3.
The new root key shared only between two UEs is generated securely after Direct authentication and key establishment procedures.
The initiating UE's security capabilities are sent back to the initiating UE.
The receiving UE integrity protects the Direct Security Mode Command message with the new security context before sending it to the initiating UE.
relayThis solution reuses the existing slice-specific authentication and secondary authentication procedures specified in.
The secondary authentication procedure for the PDU session is performed via the N3IWF as specified in.
This solution requires Remote UE to be in coverage to obtain the discovery keys.
The UE-to-network relay gets the discovery key in the same way as the Remote UE.
The Remote UE connects to the network and gets authorized to be a Remote UE.
NOTE 4: When and how often the discovery keys need to be generated is left for normative work.
Step 6: For every VPLMN in the VPLMN list, its 5GDDNMF sends the key response to the 5GDDNMF of the HPLMN of the Remote UE.
The key response message includes at least the following information: PLMN ID, Remote UE ID, ProSe application ID, Relay service code, Discovery key.
The PLMN list sent in step 1 in clause 6.35.2.1 indicates HPLMNs of the UE-to-network relays that the Remote UE wants to discover.
When a 5GDDNMF receives the key request, it checks if the Remote UE can discover the relay belonging to the corresponding PLMN.
The 5GDDNMF of the UE-to-network relay does not need to contact 5GDDNMFs in other PLMNs.
Step 1: The UE-to-network relay establishes a secure connection with its 5GDDNMF of the UE-to-network relay of its HPLMN.
The UE-to-network relay ID is authenticated and authorized by the 5GDDNMF of the UE-to-network relay.
As this connection is established in the user plane, the same mechanism as used to protect the PC3 interface can be re-used.
Either solution #5 or solution #11 can be used for securing the connection.
Step 2: The UE-to-network relay sends the key request to its 5GDDNMF of its HPLMN to get the discovery key.
The key request includes at least the following information: optionally its own HPLMN ID, UE-to-network relay ID, ProSe application ID and Relay service code.
If the key management is done by another NF (network function) i.e. 5G PKMF, the 5GDDNMF will contact that NF to get the discovery key.
Step 5: The 5GDDNMF sends the key response to the UE-to-network relay.
The key response message includes at least the following information: optionally the PLMN ID, UE ID, ProSe application ID, Relay service code, Discovery key.
This solution has no impact on network nodes, RAN, AMF and AUSF.
This solution has an impact on network nodes, 5GDDNMF and potentially the UDM.
The 5G PKMF could interact with the 5G DDNMF via SBI.
The DDNMF acts as an AKAM AF and can derive the KDIRECT, which is a key shared between two entities (Remote UE and Relay UE).1.
This step happens before the Remote UE tries to access the UE-to Network relay service.3.
The Remote UE sends a Direct Communication Request on PC5 interface.
The Direct Communication Request message includes the A-KID, a freshness parameter Nonce_1, relay service code and the Remote DDNMF ID.
The Remote DDNMF ID can be used to find the specific DDNMF.4.
The Relay UE receives the Direct Communication Request and sends a Direct key request to the Relay DDNMF.
The Direct Key Request message includes the A-KID, a freshness parameter Nonce_1, relay service code and the Remote DDNMF ID.6~8.
If the Remote DDNMF does not have the KDDNMF which is identity by the A-KID.
Remote DDNMF also generates the KDIRECT ID.Option 2: (The Relay UE can directly connect to the Remote DDNMF)5~8.
Group member discovery uses provisioned keys to support integrity, confidentiality and non-trackability of the discovery messages.
A discovery root key from which other keys can be derived is used to secure over the air discovery and communications.
This root key can be provisioned by the 5G DDNMF and/or by the 5G PKMF â€“ this clarification is left for the normative stage.
The UE connects to the network and obtains authorization from the PCF/ProSe App Server to perform Group Member discovery.
The UE also gets the address of the 5GDDNMF of its HPLMN and/or of the 5G PKMF.
Either solution #5 or solution #11 can be used for securing the connection.
Step 2: The UE sends a discovery key request to the 5GDDNMF or the 5G PKMF of its HPLMN.
In the key request includes at least the following information: UE ID, set of one or more Application Layer Group IDs and their validity times.
PSDKs that have not expired can be used for discovery in out of coverage cases.
NOTE 4: Could you please rephrase the sentence in order to avoid the use of "has to", "have to" and "required to")?
Instead of the parameter Application Layer Group ID, the Relay Service Code is used.
UE is provisioned by the PCF/ProSe App Server with the address of the 5G DDNMF and/or the 5G PKMF.
This solution has no impact on the RAN or the network nodes AMF, AUSF.
The security policies for eV2X UEs eV2X allows different security policies at different geographic locations).
The A-DDNMF further gets one-to-one communication security policy of the ProSe service related to the Discovery Request in step 1.
The security status of the one-to-one communication of the ProSe service is decided based on the security policy.
The A-DDNMF responds to the M-DDNMF with a Monitor Response message including the discovery parameters, the associated security materials and the security policy.
This solution involves the ProSe discovery procedure related to Key Issue #1 and one-to-one communication establishment procedure related to Key Issue #12.
This solution also addresses Key Issue#17 about provisioning PC5 security policies to UE.
this solution, UEs receive the security policies from 5G DDNMFs upon requesting the discovery parameters of specific ProSe service.
The P-TID is derived from KAUSF as specified in clause 6.39.2.2.5.
The Remote UE discovers the UE-to-network Relay using either model A or model B discovery.
The Remote UE derives P-KID using the same method as the remote AUSF.
The Direct Communication Request contains the Relay Service Code, P-KID and Nonce1.11.
If authorized, The AMF discovers the UDM based on the P-KID, the relay AMF sends Nudm_AUSFID_Get request with P-KID to the UDM.13.
AMF further sends Nausf_ProSe_RemoteKey request with P-KID, Relay service code, Nonce 1 to the remote AUSF.
The remote AUSF generates KR freshness parameter and derives KR using at least Kausf, relay service code, KR freshness parameter and Nonce 1 as input.16.
The relay AMF sends NAS remote Key response KR, KR freshness parameter to the UE-to-network relay.17.
The UE-to-network relay sends a Direct Security Mode Command message to the Remote UE, KR freshness parameter and Nonce 2 are included in the message.
The Remote UE derives the KR key in the same way as the remote AUSF in step 14.
The UE-to-network relay notifies the remote AUSF in steps 19a and 19b, about the Remote UE successfully receiving the Direct Security Mode Command message.
The AUSF generates a new P-KID from the KAUSF in step 19c (i.e. after step 19a and 19b).
Steps 19-21 are skipped if the UE-to-network relay fails to receive the Direct Security Mode Complete message.
The username part includes the Routing Identifier and the P-TID*, and the realm part includes Home Network Identifier.
For ProSe direct communication, the configuration of PC5 security policies could reuse the mechanism for V2X services defined in.
For ProSe relay communication, the security policies for PC5 control plane is always be set to "REQUIRED".
This solution addresses all the three potential requirements in key issue #17 by largely reusing the mechanisms defined for V2X service protection in.
To securely provision the UP security activation indication from the NG-RAN to the remote UE, both Uu signalling and PC5 signalling need to be protected.
Uu signalling security can be ensured by the AS signalling security established between the U2N relay and the NG-RAN.
The NG-RAN indicates the Uu UP security activation status to the relay UE using RRC Connection Reconfiguration procedure, according to.
Meanwhile, the NG-RAN sends N2 PDU Session Response to the AMF.
The U2N relay activates its Uu UP security based on the security activation indication received from the NG-RAN.
From this step on, the Uu UP security in Figure 6.Y.2.1-1 is protected based on the UP security policies set for the relayed service.12.
The whole message is protected with PC5 signalling security, hence the PC5 UP security activation indication sent from the relay is protected.
Meanwhile, the U2N relay sends the Remote UE Report to its SMF.14.
This largely reuses the existing mechanisms for configuration and enforcement of UP security policies defined inand.
However, the RSC is not protected in subsequent link setup procedure even when it can be protected in a similar way as in the discovery.
Note that this protection mechanism only applies when the RSC is privacy protected during restricted discovery procedure.
In the first case, if the DUIK is supplied to a monitoring UE, the monitoring UE can verify the MIC itself.
This solution complements the usage of the integrity key, the DUIK, with a Discovery User Integrity Hash Chain (DUIHC) for source authentication.
All monitoring UEs are given the anchor of the DUIHC of the announcing UE.
the validity of the MIC received in the previous message, and thus, the integrity of the message itself.
This means that:This approach requires that both announcing UEs and monitoring UEs are loosely UTC time synchronized.
Under this assumption, an attacker cannot use the disclosed hash chain links to impersonate other UEs or modify the broadcasted discovery messages.
An attacker can replay/forward messages but the attacker is not able to modify them.
Note 2: Scalability in case of many announcing UE might need further study.
In this case, the discoveree UE sends the Response Code protected with the DUIK and not with the DHCUIK.
'Get GBA AV request' in the solution flow refers to AV retrieval in PC4a interface as described in .
The Remote UE sends a Direct Communication Request on PC5 interface.
The Remote UE includes its HPLMN ID, the Nonce_1 and the KPC5 key ID together with the Relay Service Code.
The 5G PKMF uses Ks(_ext)_Step 10) The UE-to-network Relay generates a Nonce_2 and KSESS key from the KPC5-COM key and Nonce_2.
The UE-to-network Relay initiates a Direct Security Mode Command integrity protected with KSESS-IK key generated from the KSESS key.
For the open ProSe direct discovery scenario, Solution #3 is used as a basis for normative work.
- For the restricted ProSe direct discovery scenario, Solution #4 is used as a basis for normative work.
scenarioThe discovery keys include a cipher key, an integrity key and a scrambling key.
It is concluded that both control plane and user plane solutions are supported for L3 U2N relay.
For PC5 link security, PC5 keys are derived using keys derived from the primary authentication (e.g., sol#1, #10, #15, #30).
A root credential is configured in the remote UE and the network.
The shared key is individually derived from the root credential by the remote UE and the network.
The shared key is distributed by the AMF to the UE-to-Network relay.
It is concluded that the high-level procedure defined in the Solution #14 is taken as the baseline for the normative work.
The solutions for U2N Relay authorization and security can be classified as user-plane (UP) or controlled-plane (CP) based solutions.
So there is no need to conclude anything for this key issue.
In this case, the UE uses the ProSe Layer-2 Group ID as the Destination Layer-2 ID.
The privacy protection of a pre-configured Layer-2 ID is to be ensured by a proprietary manner, hence there is no need of normative work.
Hence, no conclusion can be made during the present document for this key issue.
The existing mechanism inandare capable to meet the security requirements of KI #16.
The security policy for signaling integrity protection on PC5 is set to â€œREQUIREDâ€ for all UE-to-network relay scenarios.