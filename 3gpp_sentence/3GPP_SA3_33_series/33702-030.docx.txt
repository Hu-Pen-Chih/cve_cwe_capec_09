The AUN3 device does not support NAS over non5G-RG creates NAS Registration on behalf of AUN3 device.
Authentication and key hierarchy are defined in , clause 7B-7 and Annex Z.
Figure 4.2-1 AUN3 device connection to 5GThe N5CW device does not support NAS over nonTWIF creates NAS Registration on behalf of N5CW device.
Figure 4.4-1: UE moves from WLAN AP to another WLAN AP connected via the same NSWOF 5 Key issuesNot applicable.
Temporary number can also be generated at UE and the network independently.4, 5, 6.
TNAP#2 sends the L2 EAP-Request for Identity towards the UE and the UE responds back with an L2 EAP-Response with Identity and a TNAP_Mobility_Indication flag.
The TNAP#2 sends an EAP-5G notification back to the UE with the RAND value along with MAC.
If MAC validation is successful then based on the RAND value, UE derives the keys.
TNAP#2 sends the L2 EAP-Request for Identity towards the UE and the UE responds back with an L2 EAP-Response with Identity and a TNAP_Mobility_Indication flag.
The R0KH derives PMK-R1 from PMK-R0 and provides it to the new AP (i.e., TNAP in TNAN) during the FT procedure.
Figure 6.3.2-1 shows how the 5G and FT key hierarchies link together in this solution.
Figure 6.3.2-1: Link between the 5G and FT key hierarchiesThe FT capability is advertised in the Beacon and Probe Response frames by including the MDIE.
The MDIE is advertised in the Beacon and Probe Response frames to indicate the Mobility Domain ID (MDID), FT capability, and the FT policy.
Step 1: The UE wants to connect to the AP that is advertising FT capability through inserting the MDE into Beacons and ProbeResponses.
Steps 5a-c: EAP authentication is run and results in the UE and R0KH both having PMK-R0 and PMKR0Name.
The AP is provided with PMK and the UE calculates PMK.Figure 6.3.2.2-2 shows AP mobility using the over the air procedure.
Figure 6.3.2.2-2: AP mobilityStep 1: The UE finds another AP (called target AP) advertising FT capability and the same mobility domain.
The UE sends an 802.11 Authentication Request to the Target AP including MDE, R0KH-ID, PMKR0Name and SNonce.
The target AP checks the MIC and if successful installs the derived PTK for the subsequent data exchanges.
The TNAP2 initiates an EAP session as usually by requesting the UE identity.4.
The TNAP1 selects TNGF based on the TNG1-ID in the received realm and forwards the NAI to TNGF.6a.
The new TNAP key is applied to establish over-the-air security between the UE and TNAP2.
TNGF finds the UE security context based on the UE ID, and determines to perform re-authentication procedure based on UE ID.
TNGF sends EAP-REQ message to start the re-authentication procedure, a, Nonce-TNGF and the HMAC are carried in this message.
TNGF verifies the HMAC, if the verification passes, TNGF generates KTNAP’ by using method defined in TS33.501 A.22.12.
UE and TNAP#2 establish security association by using the newly generated KTNAP’.
This solution addresses the requirement of KI #1 by generating a new KTNGF’.
In case the UE used SUCI in the primary authentication it needs to store the SUCI and use it when it wants to TNAP mobility.
This would enable UEs to move from one access point to another without performing a full primary authentication.
In short, it was specified that AUSF The TNGF would then derive further keys from rRK, as specified in RFCalso shown below.
rMSKnThis solution proposes to reuse ERP for reauthentication but modify the method of how the root key (rRK) is derived.
Instead of deriving the key rRK from EMSK, the rRK is derived from KTNGF.
Section 4.2 of RFCspecifying ERP, the properties for rRK are listed: The rRK has the following properties.
These properties apply to the rRK regardless of the parent key used to derive it.
The rRK can be derived by TNGF once a mobility request is received or at any time when it is convenient.
Alternatively, temporary number of reauth Id can be generated by UE as well.2.
The N5CW device Otherwise, N5CW device respond with SUCI or 5G-GUTI as defined in step 2b of clause 7A.2.4 of .
Alternatively, Reauth Id can be provided in step 6 as well.
TWIF creates a 5GC Registration Request message on behalf of the N5CW device.
AMF verifies the MACN5CW using KAMF and NonceAMF stored in the security context.
If the verification successful and AMF decides to skip a full authentication based on an operator's policy, the full authentication is skipped.
AMF also computes MACAMF using KAMF and NonceN5CW received in step 5.
AMF stores newly derived KAMF, 5G-GUTI, and newly generated NonceAMF in its security context.
AMF derives KTWIF from the newly derived KAMF as specified in Annex A.9 in.
NAS SMC procedure is performed as specified in clause 7A.2.4 in.
inThe N5CW device verifies the MACAMF using NonceN5CW generated in step 4 and existing KAMF.
The TNAP’s FT capability can be sent to the TNGF in any AAA message during the primary authentication.
The N5CW device associates with the trusted WLAN network and the EAP-AKA’ authentication procedure is initiated.
The token The N5CW includes the authentication token in the EAP-Response message towards the TWIF.
The N5CW device derives a new KTNAP using the KTWIF and the Nonce.
This solution addresses key issue #2: Security aspect of AUN3 device connecting to a new 5G-RG within the same W-AGF.
In this solution, full authentication AUN3 device generates a NonceAUN3 and sends it in EAP-ID-Response.
AUN3 device decides to move from 5G-RG#1 to 5G-RG#2, so 802.11 connection is established between AUN3 device and 5G-RG#2.
The AUN3 generates a new NonceAUN3 and MACAUN3, before sending back an EAP response/Identity including 5G-GUTI, NonceAUN3, and MACAUN3.
MACAUN3 is generated using MSK and NonceAMF received in step 1.
MACAUN3 5G-RG#2 sends a NAS Registration Request message to the AMF, including 5G-GUTI, AUN3 device indicator, NonceAUN3, and MACAUN3.
AMF verifies the MACAUN3 using MSK and NonceAMF stored in the security context.
If the verification is successful and AMF decides to skip a full authentication based on an operator's policy, the full authentication is skipped.
AMF also computes MACAMF using existing MSK and NonceAUN3 received in step 5.
AMF derives PMK as specified in clause 6.12.2.1.2 using existing MSK, NonceAUN3 received in step 5, NonceAMF generated in step 6.
AMF sends EAP-Success and PMK to the 5G-RG#2 in N1 message.
The 5G-RG#2 sends to the AUN3 device the EAP-Success message including 5G-GUTI, NonceAMF, and MACAMF.
The AUN3 device verifies the MACAMF using NonceAUN3 generated in step 4 and existing MSK.
The AUN3 device stores 5G-GUTI, the newly received NonceAMF, and MSK in its security context.
The AUN3 device and the 5G-RG#2 performs four-way handshaking to establish WLAN secure connection.
The EAP Response/Identity message 11: The AUSF The AUSF 12: The NSWOF 14: UE refreshes the MSK based on the RAND.
The WLAN AP provides NSWO UE Reauth ID to UE via EAP-Req/Notification.- FC = 0xx - P0 = RAND valueMSK is used as root key.
Whenever reconnection of the device, security context (e.g. previously stored key) in the AMF can be utilized to avoid repeative primary authentication.
If the N5CW device is already registered in 5GC, the AMF has security context for the N5CW device.
The AMF checks whether the N5CW device is first time registration or not.
If the N5CW device is already registered, step 6 can be skipped.
After deriviation of KTWIF, the AMF stores part of KTWIF for next reconnection.8-13.
N5CW device decides to move from TWAP#1 to TWAP#2 TWAP#2 sends an EAP request/Identity to the N5CW device.
The N5CW generates a NonceN5CW and MACN5CW, before sending back an EAP response/Identity.
The EAP response/Identity includes 5G-GUTI, Temporary UE ID, NonceN5CW, and MACN5CW.
MACN5CW is generated using KTWIF and NonceTWIF received in step 1.
MACN5CW TWAP#2 sends AAA request to TWIF and the request includes 5G-GUTI, Temporary UE ID, NonceN5CW, and MACN5CW.
If TWIF cannot retrieve the security context, TWIF creates registration request message and sends it to AMF as specified in clause 7A.2.4 in.
Otherwise, TWIF verifies the MACN5CW using KTWIF and NonceTWIF stored in its security context.
If the verification is successful and TWIF decides to skip a full authentication based on an operator's policy, the full authentication is skipped.
TWIF also computes MACTWIF using KTWIF and NonceN5CW received in step 5.
MACTWIF TWIF derives KTNAP using existing KTWIF, NonceN5CW received in step 5, and NonceTWIF gerenated in step 6, as specified in clause 6.17.2.2.
TWIF stores KTWIF, Temporary UE ID, and newly generated NonceTWIF in its security context.
TWIF sends the TNAP key, EAP Success message, NonceTWIF, and MACTWIF to the TWAP#2, which forwards EAP Success, NonceTWIF, and MACTWIF to the N5CW device.
The TNAP key corresponds to the PMK (Pairwise Master Key) which is used to secure the WLAN air-interface communication.
There are two kinds of AUN3 devices:AUN3 device supports 5G key hierarchy.
(Authentication is defined in Section 7B.7.3 of).0: AUN3 device is connected and authenticated via RG1 as defined in clause 7B.7.2 of.
AMF also stores MSK in the UE context after the successful authentication.2.
The AUN3 device Otherwise, AUN3 device respond with Network Access Identifier (NAI) in the form of username@realm.
If the AUN3 device supports SUPI privacy, the AUN3 device 6.
The AUN3 and the 5G-RG performs four-way handshaking to establish WLAN secure connection.
Key Derivation- FC = 0xx - P0 = RAND valueMSK is used as root key.1.
AUN3 device wants to connect to RG2 and it initiates a layer 2 connection with the 5G-RG either via Ethernet or WLAN.
If the layer 2 connection is based on Ethernet, steps 12-14 are skipped.
The AUN3 device Otherwise, AUN3 device respond with Network Access Identifier (NAI) in the form of username@realm.
This message is sent via W-AGF where W-AGF just relay it via N2.
The 5G-RG sends to the AUN3 device the EAP-Success message, RAND and MAC in a layer 2 frame.
In this solution, full authentication AUN3 device generates a NonceAUN3 and sends it in EAP-ID-Response.
AUN3 device initiates a layer 2 connection with the 5G-RG#2 either via Ethernet or WLAN.
The AUN3 generates NonceAUN3 and MACAUN3, before sending back an EAP response/Identity.
The EAP response/Identity includes SUCI, Temporary UE ID received in step 1, NonceAUN3, and MACAUN3.
MACAUN3 is generated using MSK and NonceWAGF received in step 1.
MACAUN3 5G-RG#2 sends a NAS Registration Request message to the W-AGF, including SUCI, Temporary UE ID, AUN3 device indicator, NonceAUN3, and MACAUN3.
W-AGF verifies the MACAUN3 using MSK and NonceWAGF stored in the security context.
If the verification is successful and W-AGF decides to skip a full authentication based on an operator's policy, the full authentication is skipped.
W-AGF also computes MACWAGF using existing MSK and NonceAUN3 received in step 5.
MACWAGF W-AGF stores MSK, Temporary UE ID, and newly generated NonceWAGF in its security context.
W-AGF derives the key as specified in clause 6.19.2.1.2 using existing MSK, NonceAUN3 received in step 5, NonceWAGF generated in step 6.
W-AGF sends EAP-Success and the key to the 5G-RG#2 in N1 message.
AUN3 device initiates a layer 2 connection with the 5G-RG#2 either via Ethernet or WLAN.
The AUN3 generates NonceAUN3 and MACAUN3, before sending back an EAP response/Identity.
The EAP response/Identity includes SUCI, Temporary UE ID, NonceAUN3, and MACAUN3.
MACAUN3 is generated using KWAGF and NonceWAGF received in step 1.
Otherwise, W-AGF verifies the MACAUN3 using KWAGF and NonceWAGF stored in the security context.
If the verification is successful and W-AGF decides to skip a full authentication based on an operator's policy, the full authentication is skipped.
W-AGF also computes MACWAGF using KWAGF and NonceAUN3 received in step 5.
W-AGF derives a new key as specified in clause 6.19.2.2.2 using existing KWAGF, NonceAUN3 received in step 5, NonceWAGF generated in step 6.
W-AGF sends EAP-Success, the key derived from KWAGF, MACWAGF, and NonceWAGF to the 5G-RG#2.
The 5G-RG#2 sends to the AUN3 device the EAP-Success message including Temporary UE ID, NonceWAGF, and MACWAGF.
The AUN3 device verifies the MACWAGF using NonceAUN3 generated in step 4 and existing KWAGF.
The AUN3 device stores Temporary UE ID, the newly received NonceWAGF, and KWAGF in its security context.
The AUN3 device and the 5G-RG#2 perform four-way handshaking to establish WLAN secure connection.
Each solution 6.Y.3 Evaluation7 Conclusions Editor’s Note: This clause contains the agreed conclusions that will form the basis for any normative work.
It is concluded to use a fast BSS transition-based solution 7 as a base for the normative work.